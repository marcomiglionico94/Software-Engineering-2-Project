\section{Cms Events}

Given an http request and an http response, the cms method checks if the request is valid or not and it assign the proper status code to the http response. The status code is provided by the verifyContentToWebSite function, that can return three status codes: OK, NOT FOUND and GONE. If the status code is not OK, then the function cms tries to find a specific error page for this website, concerning the status code. If this is not possible then it tries to find a generic (not related to this current website) content error page concerning the status code.

If the status code found with the verifyContentToWebSite function was ok or we found an error page with one of the two previous researches, then we call the function ContentWorker.renderContentAsText.
This function takes as input a "content id". If the status code is ok, then the content id refers to the one specified in the request, otherwise it refers to the error page that was found.

\subsection{wiki}

In the public wiki, this class is mentioned in the page "OFBiz Content Management How to"\footnote{https://cwiki.apache.org/confluence/display/OFBIZ/OFBiz+Content+Management+How+to}. Here, you can understand that this class is useful if you want to setup a content driven website. In fact, to do a quickly initial setup, you can add to the controller.xml file the following (or similar) entries:

\lstset{
    language=xml,
    tabsize=3,
    %frame=lines,
    caption=Test,
    label=code:sample,
    frame=shadowbox,
    rulesepcolor=\color{gray},
    xleftmargin=20pt,
    framexleftmargin=15pt,
    keywordstyle=\color{blue}\bf,
    commentstyle=\color{OliveGreen},
    stringstyle=\color{red},
    numbers=left,
    numberstyle=\tiny,
    numbersep=5pt,
    breaklines=true,
    showstringspaces=false,
    basicstyle=\footnotesize,
    emph={path},emphstyle={\color{magenta}}}
    \lstinputlisting{functional_role/cms_events_example.xml}
    
%TODO change this
In this way, by default all the incoming requests will be dispatched to the CmsEvents event.
This event will use the data in the Content data model to generate the content of the page and will return it back to the browser.
In this way it will be possible to add new pages just editing the data in the Content data model and without editing the controller.xml file.




\subsection{cms method}

The cms method starts taking some info from the http servlet request that was passed to the function, i.e. the delegator, the local dispatcher, the servlet context and the http session, the locale, the website id, the target request and the actual request. It also checks the validity of these last three variables and it manages the case in which they are not specified in the request.

If in the session it is indicated to display the maintenance page, then the maintenance page will be rendered as text/html.

Else, the function identifies the path info of the request, evaluating if there is a specified one or if the default one must be considered and then it parses the path info and gets its alias.
If the content id of the alias is null, then the request dispatcher forwards the request to the servlet of the request, that has its path elements and parameters adjusted to match the path of the target resource. In this way, the cms method does preliminary processing of the request and the other servlet generates the response. 
Then it verifies that the request content is associated with the current website and sets the proper status code ("404 NOT FOUND" if the content id is null). If the status code is different from the "200 OK", then the method tries to find a specific Error page for this website concerning the status code
